-- Creacion de las tablas de dimensiones
CREATE TABLE NAPOLITANA_CON_FRITAS.BI_Potencia_Rango (
ID int PRIMARY KEY,
RANGO varchar(10)
);

CREATE TABLE NAPOLITANA_CON_FRITAS.BI_Mes (
ID int IDENTITY PRIMARY KEY,
ANIO int,
MES int
);

CREATE TABLE NAPOLITANA_CON_FRITAS.BI_Cliente_Edad_Rango(
ID int PRIMARY KEY,
RANGO varchar(15)
);

CREATE TABLE NAPOLITANA_CON_FRITAS.BI_Sexo(
ID int PRIMARY KEY,
SEXO varchar(10)
);

CREATE TABLE NAPOLITANA_CON_FRITAS.BI_Cantidad_Rango(
ID int PRIMARY KEY,
RANGO varchar(20)
);

-- Creacion de las tablas de hechos
CREATE TABLE NAPOLITANA_CON_FRITAS.BI_Venta_Auto(
MES_ID int,-- FECHA datetime2(3),
SUCURSAL_ID decimal(18,0),
CLIENTE_EDAD_RANGO_ID int,
CLIENTE_SEXO_ID int,
MODELO_ID decimal(18,0),
FABRICANTE_ID decimal(18,0),
TIPO_AUTO_ID decimal(18,0),
TIPO_CAJA_ID decimal(18,0),
TIPO_MOTOR_ID decimal(18,0), 
TIPO_TRANSMISION_ID decimal(18,0),
POTENCIA_RANGO_ID int,
PRECIO decimal(18,2),
PRIMARY KEY (MES_ID,SUCURSAL_ID,MODELO_ID,FABRICANTE_ID,TIPO_AUTO_ID,TIPO_CAJA_ID,TIPO_MOTOR_ID,TIPO_TRANSMISION_ID,POTENCIA_RANGO_ID),
FOREIGN KEY (MES_ID) REFERENCES NAPOLITANA_CON_FRITAS.BI_Mes(ID),
FOREIGN KEY (SUCURSAL_ID) REFERENCES NAPOLITANA_CON_FRITAS.Sucursal(SUCURSAL_ID),
FOREIGN KEY (CLIENTE_EDAD_RANGO_ID) REFERENCES NAPOLITANA_CON_FRITAS.BI_Cliente_Edad_Rango(ID),
FOREIGN KEY (CLIENTE_SEXO_ID) REFERENCES NAPOLITANA_CON_FRITAS.BI_Sexo(ID),
FOREIGN KEY (MODELO_ID) REFERENCES NAPOLITANA_CON_FRITAS.Modelo(MODELO_CODIGO),
FOREIGN KEY (FABRICANTE_ID) REFERENCES NAPOLITANA_CON_FRITAS.Fabricante(FABRICANTE_ID),
FOREIGN KEY (TIPO_AUTO_ID) REFERENCES NAPOLITANA_CON_FRITAS.Tipo_Auto(TIPO_AUTO_CODIGO),
FOREIGN KEY (TIPO_CAJA_ID) REFERENCES NAPOLITANA_CON_FRITAS.Tipo_Caja(TIPO_CAJA_CODIGO),
FOREIGN KEY (TIPO_TRANSMISION_ID) REFERENCES NAPOLITANA_CON_FRITAS.Tipo_Transmision(TIPO_TRANSMISION_CODIGO),
FOREIGN KEY (POTENCIA_RANGO_ID) REFERENCES NAPOLITANA_CON_FRITAS.BI_Potencia_Rango(ID)
);

CREATE TABLE NAPOLITANA_CON_FRITAS.BI_Compra_Auto(
MES_ID int,-- FECHA datetime2(3),
SUCURSAL_ID decimal(18,0),
CLIENTE_EDAD_RANGO_ID int,
CLIENTE_SEXO_ID int,
MODELO_ID decimal(18,0),
FABRICANTE_ID decimal(18,0),
TIPO_AUTO_ID decimal(18,0),
TIPO_CAJA_ID decimal(18,0),
TIPO_MOTOR_ID decimal(18,0),
TIPO_TRANSMISION_ID decimal(18,0),
POTENCIA_RANGO_ID int,
PRECIO decimal(18,2),
PRIMARY KEY (MES_ID,SUCURSAL_ID,MODELO_ID,FABRICANTE_ID,TIPO_AUTO_ID,TIPO_CAJA_ID,TIPO_MOTOR_ID,TIPO_TRANSMISION_ID,POTENCIA_RANGO_ID),
FOREIGN KEY (MES_ID) REFERENCES NAPOLITANA_CON_FRITAS.BI_Mes(ID),
FOREIGN KEY (SUCURSAL_ID) REFERENCES NAPOLITANA_CON_FRITAS.Sucursal(SUCURSAL_ID),
FOREIGN KEY (CLIENTE_EDAD_RANGO_ID) REFERENCES NAPOLITANA_CON_FRITAS.BI_Cliente_Edad_Rango(ID),
FOREIGN KEY (CLIENTE_SEXO_ID) REFERENCES NAPOLITANA_CON_FRITAS.BI_Sexo(ID),
FOREIGN KEY (MODELO_ID) REFERENCES NAPOLITANA_CON_FRITAS.Modelo(MODELO_CODIGO),
FOREIGN KEY (FABRICANTE_ID) REFERENCES NAPOLITANA_CON_FRITAS.Fabricante(FABRICANTE_ID),
FOREIGN KEY (TIPO_AUTO_ID) REFERENCES NAPOLITANA_CON_FRITAS.Tipo_Auto(TIPO_AUTO_CODIGO),
FOREIGN KEY (TIPO_CAJA_ID) REFERENCES NAPOLITANA_CON_FRITAS.Tipo_Caja(TIPO_CAJA_CODIGO),
FOREIGN KEY (TIPO_TRANSMISION_ID) REFERENCES NAPOLITANA_CON_FRITAS.Tipo_Transmision(TIPO_TRANSMISION_CODIGO),
FOREIGN KEY (POTENCIA_RANGO_ID) REFERENCES NAPOLITANA_CON_FRITAS.BI_Potencia_Rango(ID)
);

CREATE TABLE NAPOLITANA_CON_FRITAS.Venta_Autoparte(
AUTOPARTE_ID decimal(18,0),
MES_ID int,-- FECHA datetime2(3),
SUCURSAL_ID decimal(18,0),
CLIENTE_EDAD_RANGO_ID int,
CLIENTE_SEXO_ID int,
MODELO_ID decimal(18,0),
FABRICANTE_ID decimal(18,0),
CANTIDAD_RANGO_ID int,
PRECIO decimal(18,2),
PRIMARY KEY (AUTOPARTE_ID,MES_ID,SUCURSAL_ID,CLIENTE_EDAD_RANGO_ID,CLIENTE_SEXO_ID,MODELO_ID,FABRICANTE_ID,CANTIDAD_RANGO_ID),
FOREIGN KEY (AUTOPARTE_ID) REFERENCES NAPOLITANA_CON_FRITAS.Autoparte(AUTOPARTE_CODIGO),
FOREIGN KEY (MES_ID) REFERENCES NAPOLITANA_CON_FRITAS.BI_Mes(ID),
FOREIGN KEY (SUCURSAL_ID) REFERENCES NAPOLITANA_CON_FRITAS.Sucursal(SUCURSAL_ID),
FOREIGN KEY (CLIENTE_EDAD_RANGO_ID) REFERENCES NAPOLITANA_CON_FRITAS.BI_Cliente_Edad_Rango(ID),
FOREIGN KEY (CLIENTE_SEXO_ID) REFERENCES NAPOLITANA_CON_FRITAS.BI_Sexo(ID),
FOREIGN KEY (FABRICANTE_ID) REFERENCES NAPOLITANA_CON_FRITAS.Fabricante(FABRICANTE_ID),
FOREIGN KEY (CANTIDAD_RANGO_ID) REFERENCES NAPOLITANA_CON_FRITAS.BI_Cantidad_Rango(ID)
);

CREATE TABLE NAPOLITANA_CON_FRITAS.Compra_Autoparte(
AUTOPARTE_ID decimal(18,0),
MES_ID int,-- FECHA datetime2(3),
SUCURSAL_ID decimal(18,0),
CLIENTE_EDAD_RANGO_ID int,
CLIENTE_SEXO_ID int,
MODELO_ID decimal(18,0),
FABRICANTE_ID decimal(18,0),
CANTIDAD_RANGO_ID int,
PRECIO decimal(18,2),
PRIMARY KEY (AUTOPARTE_ID,MES_ID,SUCURSAL_ID,CLIENTE_EDAD_RANGO_ID,CLIENTE_SEXO_ID,MODELO_ID,FABRICANTE_ID,CANTIDAD_RANGO_ID),
FOREIGN KEY (AUTOPARTE_ID) REFERENCES NAPOLITANA_CON_FRITAS.Autoparte(AUTOPARTE_CODIGO),
FOREIGN KEY (MES_ID) REFERENCES NAPOLITANA_CON_FRITAS.BI_Mes(ID),
FOREIGN KEY (SUCURSAL_ID) REFERENCES NAPOLITANA_CON_FRITAS.Sucursal(SUCURSAL_ID),
FOREIGN KEY (CLIENTE_EDAD_RANGO_ID) REFERENCES NAPOLITANA_CON_FRITAS.BI_Cliente_Edad_Rango(ID),
FOREIGN KEY (CLIENTE_SEXO_ID) REFERENCES NAPOLITANA_CON_FRITAS.BI_Sexo(ID),
FOREIGN KEY (FABRICANTE_ID) REFERENCES NAPOLITANA_CON_FRITAS.Fabricante(FABRICANTE_ID),
FOREIGN KEY (CANTIDAD_RANGO_ID) REFERENCES NAPOLITANA_CON_FRITAS.BI_Cantidad_Rango(ID)
);

-- ¿¿¿cantidad de cambios???
-- podemos reutilizar tablas del modelo relacional? (sucursal, modelo, fabricante,etc)
-- TIPO_MOTOR_ID no esta normaliza, es solo codigo en Auto ¿como hacer la dimension?

-- Se populan las tablas parametricas del modelo BI
INSERT INTO NAPOLITANA_CON_FRITAS.BI_Potencia_Rango (ID, RANGO) 
VALUES (1,'50-150cv'), (2,'151-300cv'), (3,'>300cv');

INSERT INTO NAPOLITANA_CON_FRITAS.BI_Cliente_Edad_Rango (ID, RANGO) 
VALUES (1,'18 - 30 años'), (2,'31 - 50 años'), (3,'> 50 años');

INSERT INTO NAPOLITANA_CON_FRITAS.BI_Sexo (ID, SEXO) 
VALUES (1,'Mujer'), (2,'Hombre'), (3,'No informa');

INSERT INTO NAPOLITANA_CON_FRITAS.BI_Cantidad_Rango(ID, RANGO) 
VALUES (1,'1 - 10 items'), (2,'11 - 50 items'), (3,'51 - 100 items'), (4,'> 100 items');

-- Drop tables
DROP TABLE NAPOLITANA_CON_FRITAS.BI_Venta_Auto;
DROP TABLE NAPOLITANA_CON_FRITAS.BI_Compra_Auto;
DROP TABLE NAPOLITANA_CON_FRITAS.Venta_Autoparte;
DROP TABLE NAPOLITANA_CON_FRITAS.Compra_Autoparte;
DROP TABLE NAPOLITANA_CON_FRITAS.BI_Cliente_Edad_Rango;
DROP TABLE NAPOLITANA_CON_FRITAS.BI_Cantidad_Rango;
DROP TABLE NAPOLITANA_CON_FRITAS.BI_Mes;
DROP TABLE NAPOLITANA_CON_FRITAS.BI_Potencia_Rango;
DROP TABLE NAPOLITANA_CON_FRITAS.BI_Sexo;